{% extends 'defects/base.html' %}

{% block content %}
  <main>

    <div class="d-flex justify-content-between align-items-center">
      <h2>Reliability Incident {{ incident.code }} 48H Notification</h2>
      <div>
        <a href="{% url 'incident_detail' incident.pk %}" class="btn btn-secondary btn-sm">Back to Incident</a>
        {% if perms.defects.request_notification_approval %}
        <a href="{% url 'incident_notification_publish' incident.pk %}" up-layer="new" class="btn btn-primary btn-sm">Request Approval</a>
        {% endif %}
        <a href="{% url 'incident_notification_pdf' incident.pk %}" target="_blank" class="btn btn-primary btn-sm">Download PDF</a>
      </div>
    </div>

    <hr>

    <div style="max-width: 700px">
      <table class="table">
        <tbody>
        <tr>
          <th>Operation</th>
          <td>{{ incident.operation }}</td>
        </tr>
        <tr>
          <th>Area</th>
          <td>{{ incident.area }}</td>
        </tr>
        <tr>
          <th>Section</th>
          <td>{{ incident.section }}</td>
        </tr>
        <tr>
          <th>Functional Location</th>
          <td>{{ incident.equipment }}</td>
        </tr>
        <tr>
          <th>HPI Notification Number</th>
          <td>{{ incident.code }}</td>
        </tr>
        <tr>
          <th>Start Date</th>
          <td>{{ incident.time_start|date:"Y-m-d" }}</td>
        </tr>
        <tr>
          <th>Start Time</th>
          <td>{{ incident.time_start|date:"H:i" }}</td>
        </tr>
        <tr>
          <th>End Date</th>
          <td>{{ incident.time_end|date:"Y-m-d" }}</td>
        </tr>
        <tr>
          <th>End Time</th>
          <td>{{ incident.time_end|date:"H:i" }}</td>
        </tr>
        <tr>
          <th>Section Engineer</th>
          <td>{{ incident.section_engineer }}</td>
        </tr>
        <tr>
          <th>Trigger</th>
          <td>{{ incident.get_trigger_display }}</td>
        </tr>
        </tbody>
      </table>

      <h4>Description</h4>

      {{ incident.long_description|linebreaks }}

      <h4>Immediate action that was taken</h4>
      {{ incident.immediate_action_taken|linebreaks }}
      <h4>Remaining risk after immediate action was taken</h4>
      {{ incident.remaining_risk|linebreaks }}
      <h4>Images / plans</h4>
      <div style="max-width: 600px">
        {% for image in images %}
          <figure>
            <img src="{{ image.image.url }}" alt="" style="width:100%">
            <figcaption>Figure {{ forloop.counter }}: {{ image.description }}</figcaption>
          </figure>
        {% endfor %}
      </div>
    </div>


  </main>

{% endblock %}

{% block extra_scripts %}
  <script>
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
  </script>
{% endblock %}
